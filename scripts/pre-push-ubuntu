#!/bin/bash

# Retrieve changed Kotlin files from the recent commit
CHANGED_FILES=$(git diff --name-only HEAD~1 -- '*.kt')
echo "Changed files are: $CHANGED_FILES"

# Exit early if no Kotlin files changed
if [ -z "$CHANGED_FILES" ]; then
    echo "No Kotlin files changed."
    exit 0
fi

# Ensure Gradle execution from the root project
cd "$(git rev-parse --show-toplevel)"

# Run Ktlint check only for changed files
./gradlew ktlintCheck --files $(echo "$CHANGED_FILES" | tr '\n' ',')

# Check the exit status of the Ktlint check
if [ $? -ne 0 ]; then
    echo "Ktlint check failed on some files."
    exit 1
fi

echo "Ktlint check passed on all changed files."
exit 0

